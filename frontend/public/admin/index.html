<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .stat { background: #f0f0f0; padding: 20px; margin: 10px; border-radius: 5px; }
        .error { color: red; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Admin Dashboard</h1>
    <button onclick="loadData()">刷新数据</button>
    
    <div class="stat">
        <h3>统计信息</h3>
        <p>用户数: <span id="user-count">--</span></p>
        <p>日志数: <span id="log-count">--</span></p>
        <p>评分数: <span id="score-count">--</span></p>
        <p>决策数: <span id="decision-count">--</span></p>
    </div>
    
    <div id="users-section">
        <h3>用户列表</h3>
        <div id="users-data">加载中...</div>
    </div>
    
    <div id="logs-section">
        <h3>最新日志</h3>
        <div id="logs-data">加载中...</div>
    </div>
    
    <script>
        const BACKEND_URL = "https://web-production-5fb04.up.railway.app";
        
        async function loadData() {
            console.log("开始加载数据...");
            
            try {
                // 加载用户数据
                const usersResponse = await fetch(`${BACKEND_URL}/your_name`);
                const users = await usersResponse.json();
                document.getElementById("user-count").textContent = users.length;
                
                let usersHtml = "<ul>";
                users.forEach(user => {
                    usersHtml += `<li>${user.user_name}</li>`;
                });
                usersHtml += "</ul>";
                document.getElementById("users-data").innerHTML = usersHtml;
                
                // 加载日志数据
                const logsResponse = await fetch(`${BACKEND_URL}/user_logs`);
                const logs = await logsResponse.json();
                document.getElementById("log-count").textContent = logs.length;
                
                let logsHtml = "<table><tr><th>用户</th><th>类型</th><th>时间</th></tr>";
                logs.slice(-10).forEach(log => {
                    logsHtml += `<tr><td>${log.user_name}</td><td>${log.type}</td><td>${log.timestamp}</td></tr>`;
                });
                logsHtml += "</table>";
                document.getElementById("logs-data").innerHTML = logsHtml;
                
                // 加载评分数据
                const scoresResponse = await fetch(`${BACKEND_URL}/block_scores`);
                const scores = await scoresResponse.json();
                document.getElementById("score-count").textContent = scores.length;
                
                // 加载决策数据
                const decisionsResponse = await fetch(`${BACKEND_URL}/decision_log`);
                const decisions = await decisionsResponse.json();
                document.getElementById("decision-count").textContent = decisions.length;
                
                console.log("数据加载完成");
                
            } catch (error) {
                console.error("加载失败:", error);
                document.getElementById("users-data").innerHTML = `<div class="error">加载失败: ${error.message}</div>`;
                document.getElementById("logs-data").innerHTML = `<div class="error">加载失败: ${error.message}</div>`;
            }
        }
        
        // 页面加载时自动加载数据
        window.addEventListener("load", loadData);
    </script>
</body>
</html>
